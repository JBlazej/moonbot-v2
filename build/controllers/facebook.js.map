{"version":3,"sources":["../../src/controllers/facebook.js"],"names":["req","res","VERIFY_TOKEN_SET","VERIFY_TOKEN","mode","query","token","challenge","status","send","sendStatus","facebookVerificationHook","body","object","entry","forEach","messaging","event","console","log","facebookEventHook"],"mappings":";;;;;;;;uEAGO,iBAAyCA,GAAzC,EAA8CC,GAA9C;AAAA;AAAA;AAAA;AAAA;AAAA;AACJ;AACIC,wCAFA,GAEmBC,mBAFnB;;AAIJ;;AACIC,4BALA,GAKOJ,IAAIK,KAAJ,CAAU,UAAV,CALP;AAMAC,6BANA,GAMQN,IAAIK,KAAJ,CAAU,kBAAV,CANR;AAOAE,iCAPA,GAOYP,IAAIK,KAAJ,CAAU,eAAV,CAPZ;;AASJ;;AACA,4BAAID,QAAQE,KAAZ,EAAmB;AACjB,gCAAIF,SAAS,WAAT,IAAwBE,UAAUJ,gBAAtC,EAAwD;;AAEtDD,oCAAIO,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqBF,SAArB;AACD,6BAHD,MAGO;AACLN,oCAAIS,UAAJ,CAAe,GAAf;AACD;AACF;;AAjBG;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,K;;oBAAgBC,wB;;;;;;wEAoBhB,kBAAiCX,GAAjC,EAAsCC,GAAtC;AAAA;AAAA;AAAA;AAAA;AAAA;AACCW,4BADD,GACQZ,IAAIY,IADZ;;;AAGH,4BAAIA,KAAKC,MAAL,KAAgB,MAApB,EAA4B;AACxB;AACAD,iCAAKE,KAAL,CAAWC,OAAX,CAAmB,UAASD,KAAT,EAAgB;AAC/BA,sCAAME,SAAN,CAAgBD,OAAhB,CAAwB,UAAUE,KAAV,EAAiB;AACrCC,4CAAQC,GAAR,CAAYF,KAAZ;AACA,4EAAuBA,KAAvB;AACH,iCAHD;AAIAhB,oCAAIO,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB,gBAArB;AACH,6BAND;AAOH,yBATD,MASO;AACHR,gCAAIS,UAAJ,CAAe,GAAf;AACH;;AAdE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,K;;oBAAeU,iB;;;;;AAvBtB;;AACA","file":"facebook.js","sourcesContent":["import {botMessengerMiddleware} from '../bot/middleware'\nimport {VERIFY_TOKEN} from '../conf/graph'\n\nexport async function  facebookVerificationHook(req, res) {\n   // Your verify token. Should be a random string.\n   let VERIFY_TOKEN_SET = VERIFY_TOKEN\n     \n   // Parse the query params\n   let mode = req.query['hub.mode']\n   let token = req.query['hub.verify_token']\n   let challenge = req.query['hub.challenge']\n     \n   // Checks if a token and mode is in the query string of the request\n   if (mode && token) {\n     if (mode === 'subscribe' && token === VERIFY_TOKEN_SET) {\n         \n       res.status(200).send(challenge)\n     } else {\n       res.sendStatus(403);    \n     }\n   }\n}\n\nexport async function facebookEventHook(req, res){\n    let body = req.body\n\n    if (body.object === 'page') {\n        // Iterates over each entry - there may be multiple if batched\n        body.entry.forEach(function(entry) {\n            entry.messaging.forEach(function (event) {\n                console.log(event)\n                botMessengerMiddleware(event)\n            })\n            res.status(200).send('EVENT_RECEIVED')\n        })\n    } else {\n        res.sendStatus(404)\n    }\n}"]}