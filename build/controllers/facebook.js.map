{"version":3,"sources":["../../src/controllers/facebook.js"],"names":["req","res","VERIFY_TOKEN","mode","query","token","challenge","status","send","sendStatus","facebookVerificationHook","body","object","entry","forEach","messaging","event","console","log","facebookEventHook"],"mappings":";;;;;;;;uEAEO,iBAAyCA,GAAzC,EAA8CC,GAA9C;AAAA;AAAA;AAAA;AAAA;AAAA;AACJ;AACIC,oCAFA,GAEe,kBAFf;;AAIJ;;AACIC,4BALA,GAKOH,IAAII,KAAJ,CAAU,UAAV,CALP;AAMAC,6BANA,GAMQL,IAAII,KAAJ,CAAU,kBAAV,CANR;AAOAE,iCAPA,GAOYN,IAAII,KAAJ,CAAU,eAAV,CAPZ;;AASJ;;AACA,4BAAID,QAAQE,KAAZ,EAAmB;AACjB,gCAAIF,SAAS,WAAT,IAAwBE,UAAUH,YAAtC,EAAoD;;AAElDD,oCAAIM,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqBF,SAArB;AACD,6BAHD,MAGO;AACLL,oCAAIQ,UAAJ,CAAe,GAAf;AACD;AACF;;AAjBG;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,K;;oBAAgBC,wB;;;;;;wEAoBhB,kBAAiCV,GAAjC,EAAsCC,GAAtC;AAAA;AAAA;AAAA;AAAA;AAAA;AACCU,4BADD,GACQX,IAAIW,IADZ;;AAGH;;;;AAGA,4BAAIA,KAAKC,MAAL,KAAgB,MAApB,EAA4B;AACxB;AACAD,iCAAKE,KAAL,CAAWC,OAAX,CAAmB,UAASD,KAAT,EAAgB;AAC/BA,sCAAME,SAAN,CAAgBD,OAAhB,CAAwB,UAAUE,KAAV,EAAiB;AACrCC,4CAAQC,GAAR,CAAYF,KAAZ;AACA,0EAAqBA,KAArB;AACH,iCAHD;AAIAf,oCAAIM,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB,gBAArB;AACH,6BAND;AAOH,yBATD,MASO;AACHP,gCAAIQ,UAAJ,CAAe,GAAf;AACH;;AAjBE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,K;;oBAAeU,iB;;;;;AAtBtB","file":"facebook.js","sourcesContent":["import {botMessageMiddleware} from '../bot/middleware'\n\nexport async function  facebookVerificationHook(req, res) {\n   // Your verify token. Should be a random string.\n   let VERIFY_TOKEN = \"TriPrsaNaHrudi89\"\n     \n   // Parse the query params\n   let mode = req.query['hub.mode']\n   let token = req.query['hub.verify_token']\n   let challenge = req.query['hub.challenge']\n     \n   // Checks if a token and mode is in the query string of the request\n   if (mode && token) {\n     if (mode === 'subscribe' && token === VERIFY_TOKEN) {\n         \n       res.status(200).send(challenge)\n     } else {\n       res.sendStatus(403);    \n     }\n   }\n}\n\nexport async function facebookEventHook(req, res){\n    let body = req.body\n\n    /*if (!req.body || !req.body.entry[0] || !req.body.entry[0].messaging[0].message) {\n        return console.log('No request received')\n    }*/\n    if (body.object === 'page') {\n        // Iterates over each entry - there may be multiple if batched\n        body.entry.forEach(function(entry) {\n            entry.messaging.forEach(function (event) {\n                console.log(event)\n                botMessageMiddleware(event)   \n            })\n            res.status(200).send('EVENT_RECEIVED')\n        })\n    } else {\n        res.sendStatus(404)\n    }\n}\n"]}